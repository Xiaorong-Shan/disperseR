---
title: "Vignette - Analysis"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Note 

Here we assume that you aready prepared all the data to run the analysis and set up the project structure. If you have not done please follow the our vignette "Vignette - Preparation for analysis". 

```{r, message = FALSE, warning = FALSE}
library(hyspdisp2) # our package
library(ncdf4)
library(data.table)
library(tidyverse)
```

#### Define time periods to be run

HYSPLIT, as applied here, tracks air parcels emitted at certain times and locations. `hyspdisp` refers to these as *emissions events*. Once HYSPLIT has been run for each emissions event, the simulated parcel locations are aggregated by source, time, and location. The functions below are written to enable runs of many emissions events.

To define an object that includes all emission events in a given time period, we can use the helper function `define_inputtimes`. This takes as inputs a starting and ending day, and outputs a table of value whose rows will later correspond to inputs into the main `hyspdisp` worker functions. The following command combines the units defined above with four times a day for January-March in 2005 (we show an example for half the year here to keep the computation manageable for a desktop computer). Four daily emissions events are defined by the `start_hours` variable, and `duration = 240` denotes that the emitted air parces are tracked for 240 hours (10 days). The resulting data.table the head of which is printed in the table below. 

```{r define_inputs}
input_refs <- define_inputs( units = unitsrun,
                             startday = '2005-01-01',
                             endday = '2005-03-30',
                             start_hours =  c(0, 6, 12, 18),
                             duration = 240)

knitr::kable(head(input_refs))
```


```{r}

```

